# AI Judge: Rock-Paper-Scissors-Plus

A minimal, production-credible AI Judge built with Google Gemini, designed to demonstrate prompt-driven game logic and state management.

## Architecture

This project follows a **Prompt Authority** architecture. The core game logic, win conditions, and rule enforcement reside entirely within the LLM prompts rather than the application code.

### 1. Decision Authority

- **Game Logic**: Is the move valid? Who won? These are determined by the LLM based on the rules encoded in `prompts/system.txt`.
- **Bot Move**: The bot's move is generated by the LLM during the same inference call, ensuring a holistic evaluation of the round.
- **Intent Parsing**: Natural language input, synonyms, and emojis are interpreted by the LLM.

### 2. State Management

The Python glue code (`judge.py`) maintains a minimal state:

- `round_number`: Tracked and incremented every turn.
- `user_bomb_used`: Boolean flag.
- `bot_bomb_used`: Boolean flag.

State updates are **driven by model output**. The Python code parses the JSON response and updates its internal state based _strictly_ on what the model reports.

### 3. Logic Precedence

The System Prompt enforces a strict hierarchy to handle edge cases:

1. **Constraints**: Bomb reuse detection overrides all.
2. **Ambiguity**: Conflicting signals result in `UNCLEAR`.
3. **Invalidity**: No recognizable signals result in `INVALID`.
4. **Valid**: Clean moves proceed to winner evaluation.

## Key Edge Cases Handled

- **Ambiguity vs. Invalid**: Distinguishes between "no intent" (INVALID) and "conflicting intent" (UNCLEAR).
- **Synonyms & Emojis**: Handles "ðŸª¨", "scis", "rocky", etc., through semantic mapping in the prompt.
- **Turn Wasting**: Incorrect or unclear moves increment the round number but result in no winner, as per the rules.
- **Injection Resistance**: The system prompt explicitly forbids instruction overrides and roleplay.

## Setup

1. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```
2. Set your Gemini API Key in a `.env` file:
   ```env
   GOOGLE_API_KEY=your_key_here
   ```
3. Run the judge:
   ```bash
   python judge.py
   ```

## Implementation Details

- **Language**: Python 3.x
- **LLM**: Google Gemini 1.5 Flash
- **Output**: Pure JSON for deterministic parsing.

## Future Improvements

- **Conversation History**: Pass a short window of previous moves to the LLM for better context (though current requirements favor minimal state).
- **Persistent State**: Move from in-memory state to a simple file-based or DB-based store for multi-session support.
- **Extended Rules**: The prompt-driven nature makes it trivial to add "Lizard" or "Spock" without changing a single line of Python code.
- **Toxicty Filtering**: Explicitly handle offensive user input in the classification logic.
